% Modified based on Xiaoming Sun's template
\documentclass{article}
\usepackage{amsmath,amsfonts,amsthm,amssymb}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{extramarks}
\usepackage{chngpage}
\usepackage{soul,color}
\usepackage{graphicx,float,wrapfig}
\usepackage{enumitem}
\usepackage{array} 
\usepackage{hyperref}

\usepackage{fontspec}
\setmonofont{Consolas}
\usepackage{listings}
\usepackage{xcolor}

% \lstset{
%   basicstyle=\ttfamily
%   columns=fixed,       
%   numbers=left,                                        % 在左侧显示行号
%   numberstyle=\tiny\color{gray},                       % 设定行号格式
%   frame=none,                                          % 不显示背景边框
%   backgroundcolor=\color[RGB]{245,245,244},            % 设定背景颜色
%   keywordstyle=\color[RGB]{40,40,255},                 % 设定关键字颜色
%   numberstyle=\footnotesize\color{darkgray},           
%   commentstyle=\it\color[RGB]{0,96,96},                % 设置代码注释的格式
%   stringstyle=\rmfamily\slshape\color[RGB]{128,0,0},   % 设置字符串格式
%   showstringspaces=false,                              % 不显示字符串中的空格
%   language=c++,                                        % 设置语言
% }
\lstset{
  language = python, numbers=left, 
         numberstyle=\tiny,keywordstyle=\color{blue!70},
         commentstyle=\color{red!50!green!50!blue!50},frame=shadowbox,
         rulesepcolor=\color{red!20!green!20!blue!20},basicstyle=\ttfamily
}



\newcommand{\Class}{Pattern Recognition and Machine Learning}

% Homework Specific Information. Change it to your own
\newcommand{\Title}{Homework 6}

% In case you need to adjust margins:
\topmargin=-0.45in      %
\evensidemargin=0in     %
\oddsidemargin=0in      %
\textwidth=6.5in        %
\textheight=9.0in       %
\headsep=0.25in         %

% Setup the header and footer
\pagestyle{fancy}                                                       %
\chead{\Title}  %
\rhead{\firstxmark}                                                     %
\lfoot{\lastxmark}                                                      %
\cfoot{}                                                                %
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}}                          %
\renewcommand\headrulewidth{0.4pt}                                      %
\renewcommand\footrulewidth{0.4pt}                                      %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Some tools
\newcommand{\enterProblemHeader}[1]{\nobreak\extramarks{#1}{#1 continued on next page\ldots}\nobreak%
                                    \nobreak\extramarks{#1 (continued)}{#1 continued on next page\ldots}\nobreak}%
\newcommand{\exitProblemHeader}[1]{\nobreak\extramarks{#1 (continued)}{#1 continued on next page\ldots}\nobreak%
                                   \nobreak\extramarks{#1}{}\nobreak}%

\newcommand{\homeworkProblemName}{}%
\newcounter{homeworkProblemCounter}%
\newenvironment{homeworkProblem}[1][Problem \arabic{homeworkProblemCounter}]%
  {\stepcounter{homeworkProblemCounter}%
   \renewcommand{\homeworkProblemName}{#1}%
   \section*{\homeworkProblemName}%
   \enterProblemHeader{\homeworkProblemName}}%
  {\exitProblemHeader{\homeworkProblemName}}%

\newcommand{\homeworkSectionName}{}%
\newlength{\homeworkSectionLabelLength}{}%
\newenvironment{homeworkSection}[1]%
  {% We put this space here to make sure we're not connected to the above.

   \renewcommand{\homeworkSectionName}{#1}%
   \settowidth{\homeworkSectionLabelLength}{\homeworkSectionName}%
   \addtolength{\homeworkSectionLabelLength}{0.25in}%
   \changetext{}{-\homeworkSectionLabelLength}{}{}{}%
   \subsection*{\homeworkSectionName}%
   \enterProblemHeader{\homeworkProblemName\ [\homeworkSectionName]}}%
  {\enterProblemHeader{\homeworkProblemName}%

   % We put the blank space above in order to make sure this margin
   % change doesn't happen too soon.
   \changetext{}{+\homeworkSectionLabelLength}{}{}{}}%

\newcommand{\Answer}{\ \\\textbf{Answer:} }
\newcommand{\Acknowledgement}[1]{\ \\{\bf Acknowledgement:} #1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Make title
\title{\textmd{\bf \Class: \Title}}
  \date{\textbf{\today}}
\author{\textbf{Qingru Hu \quad 2020012996}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\begin{spacing}{1.1}
\maketitle \thispagestyle{empty}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Begin edit from here

\begin{homeworkProblem}
% \Answer \\
I use \href{https://hmmlearn.readthedocs.io/en/latest/}{\texttt{hmmlearn}} module to build HMM models.
\section*{(1)}
I use the \texttt{CategoricalHMM} model in \texttt{hmmlearn} to train the dataset, and 
I obtain from fitting the initial , the transition and emission probabilities, shown respectively 
in , Fig.2 and Fig.3.
\begin{table}[htbp]
  \centering
  \begin{tabular}{|c|c|c|}
    \hline
    Dice Type & Dice 1 & Dice 2 \\
    \hline 
    Initial Prob & 0.618 & 0.382 \\
    \hline
  \end{tabular}
  \caption{The initial probabilities}
\end{table}

\begin{table}[htbp]
  \centering
  \begin{tabular}{|c|c|c|}
    \hline
    Dice Type & Dice 1 & Dice 2 \\
    \hline 
    Dice 1 & 0.888 & 0.112 \\
    \hline
    Dice 2 & 0.156 & 0.844 \\
    \hline
  \end{tabular}
  \caption{The transition probabilities}
\end{table}

\begin{table}[htbp]
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    Dice/Point & 1 & 2 & 3& 4 & 5 & 6 \\
    \hline 
    Dice 1 & 0.158 & 0.164 & 0.184 & 0.171 & 0.191 & 0.132 \\
    \hline
    Dice 2 & 0.120 & 0.098 & 0.096 & 0.108 & 0.088 & 0.491 \\
    \hline
  \end{tabular}
  \caption{The emission probabilities}
\end{table}

The code is shown as below.
\begin{lstlisting}
import numpy as np
from hmmlearn import hmm

data = np.load('sequences.npy')
X = data.reshape(200*30, 1)
lens = np.ones(data.shape[0])*30
lens = lens.astype(int)
model = hmm.CategoricalHMM(n_components=2, random_state=10)
model.fit(X, lens)
model.score(X)
# -10434.902086730863
\end{lstlisting}

\section*{(2)}
\subsection*{Forward Algorithm}
The probability of observing sequence 6 6
6 6 using forward algorithm is $p = 0.015$.
\begin{lstlisting}
  iprob = model.startprob_
  tprob = model.transmat_
  eprob = model.emissionprob_
  
  for t in range(4):
      if t==0:
          a0 = eprob[0, 6]*iprob[0]
          a1 = eprob[1, 6]*iprob[1]
      else:
          a0 = eprob[0, 6]*(a0*tprob[0, 0] + a1*tprob[1, 0])
          a1 = eprob[1, 6]*(a0*tprob[0, 1] + a1*tprob[1, 1])
  p = a0 + a1
  # p = 0.014626307201743518
  \end{lstlisting}

\subsection*{Backward Algorithm}
The probability of observing sequence 6 6
6 6 using backward algorithm is $p = 0.015$.
\begin{lstlisting}
  iprob = model.startprob_
tprob = model.transmat_
eprob = model.emissionprob_

for t in [3, 2, 1, 0]:
    # as = np.zeros([2, 2])
    if t==3:
        b0 = 1
        b1 = 1
    else:
        b0 = tprob[0, 0]*eprob[0, 6]*b0 + tprob[0, 1]*eprob[1, 6]*b1
        b1 = tprob[1, 0]*eprob[0, 6]*b0 + tprob[1, 1]*eprob[1, 6]*b1
p = a0 + a1
# p = 0.014626307201743518
\end{lstlisting}

\section*{(3)}
This player is cheating and he switched his dice on his 12th roll.

\begin{lstlisting}
seq = np.array([3, 2, 1, 3, 4, 5, 6, 3, 1, 4, 1, 6, 6, 2, 6])
seq = seq.reshape(1, -1)
model.decode(seq)
# log_prob = -28.45720629383466,
# state_sequence = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1]
\end{lstlisting}

\end{homeworkProblem}

\begin{homeworkProblem}
\section*{2.1}

\section*{2.2}

\section*{2.3}
\subsection*{Decision Tree}
\begin{table}[htbp]
  \centering
  \begin{tabular}{|c|ccc|ccc|ccc|}
  \hline
  criterion  & \multicolumn{3}{c|}{Q\_G}                                       & \multicolumn{3}{c|}{Q\_L}                                       & \multicolumn{3}{c|}{Q\_L} \\ \hline
  max\_depth & \multicolumn{1}{c|}{I}    & \multicolumn{1}{c|}{B}     & U      & \multicolumn{1}{c|}{I}    & \multicolumn{1}{c|}{B}     & U      & \multicolumn{1}{c|}{I}    & \multicolumn{1}{c|}{B}     & U \\ \hline
  \end{tabular}
  \end{table}

\section*{2.4}

\end{homeworkProblem}


% \newpage
% \Acknowledgement{Thank Siying Yang 2020012981 for
% the discussion about Problem 2.3 and Problem 3.}

% End edit to here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{spacing}
\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
